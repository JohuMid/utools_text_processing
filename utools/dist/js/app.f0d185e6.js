(function(e){function t(t){for(var o,n,l=t[0],a=t[1],c=t[2],d=0,p=[];d<l.length;d++)n=l[d],Object.prototype.hasOwnProperty.call(r,n)&&r[n]&&p.push(r[n][0]),r[n]=0;for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o]);u&&u(t);while(p.length)p.shift()();return i.push.apply(i,c||[]),s()}function s(){for(var e,t=0;t<i.length;t++){for(var s=i[t],o=!0,l=1;l<s.length;l++){var a=s[l];0!==r[a]&&(o=!1)}o&&(i.splice(t--,1),e=n(n.s=s[0]))}return e}var o={},r={app:0},i=[];function n(t){if(o[t])return o[t].exports;var s=o[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=o,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(s,o,function(t){return e[t]}.bind(null,o));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],a=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=a;i.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"034f":function(e,t,s){"use strict";s("85ec")},"18f9":function(e,t,s){},"56d7":function(e,t,s){"use strict";s.r(t);s("e260"),s("e6cf"),s("cca6"),s("a79d");var o=s("2b0e"),r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("router-view")],1)},i=[],n={name:"App"},l=n,a=(s("034f"),s("2877")),c=Object(a["a"])(l,r,i,!1,null,null,null),u=c.exports,d=s("5c96"),p=s.n(d),m=s("8f94"),h=s.n(m),f=(s("0fae"),s("a7be"),s("8c4f")),g=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"flow-edit"},[s("el-row",{staticStyle:{"margin-bottom":"20px","border-bottom":"1px solid rgba(184, 173, 173, 0.43)"}},[s("el-col",{attrs:{span:16}},[s("el-form",{attrs:{"label-position":"left","label-width":"80px"}},[s("el-form-item",{attrs:{label:"流程名",required:""}},[s("el-input",{attrs:{size:"mini"},model:{value:e.processFlowName,callback:function(t){e.processFlowName=t},expression:"processFlowName"}})],1)],1)],1),s("el-col",{staticStyle:{"margin-top":"6px"},attrs:{span:8,align:"center"}},[s("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isEditFlow,expression:"!isEditFlow"}],attrs:{type:"primary",size:"mini",round:""},on:{click:function(t){return e.addFlowOrEdit(!0)}}},[e._v("添加流程")]),s("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isEditFlow,expression:"isEditFlow"}],attrs:{type:"primary",size:"mini",round:""},on:{click:function(t){return e.addFlowOrEdit(!1)}}},[e._v("修改流程")]),s("el-button",{attrs:{size:"mini",round:""},on:{click:e.backFlow}},[e._v("返回列表")])],1)],1),s("el-row",[s("el-col",{attrs:{span:8}},[s("div",{staticClass:"process-node"},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.processNode}},[s("el-table-column",{attrs:{prop:"name",label:"操作列表"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{attrs:{title:t.row.describe}},[e._v(e._s(t.row.name))])]}}])}),s("el-table-column",{attrs:{width:"130px",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini",icon:"el-icon-edit",circle:"",title:"编辑操作"},on:{click:function(s){return e.handleEdit(t.$index,t.row)}}}),s("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-plus",circle:"",title:"添加操作到流程"},on:{click:function(s){return e.handleAdd(t.$index,t.row)}}}),s("el-popconfirm",{staticStyle:{"margin-left":"10px"},attrs:{title:"删除后不可恢复，确定删除吗？"},on:{confirm:function(s){return e.handleDelete(t.$index,t.row)}}},[s("el-button",{attrs:{slot:"reference",size:"mini",type:"danger",icon:"el-icon-delete",circle:"",title:"删除操作"},slot:"reference"})],1)]}}])},[s("template",{slot:"header"},[s("el-button",{attrs:{type:"text",size:"mini"},on:{click:e.addProcessToFlow}},[e._v("添加操作")])],1)],2)],1)],1)]),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"process-flow"},[s("el-timeline",{attrs:{reverse:!1}},[s("el-timeline-item",{attrs:{timestamp:"要处理的文本"}},[e._v("输入文本")]),e._l(e.processFlowTime,(function(t,o){return s("el-timeline-item",{key:o},[e._v(" "+e._s(t.name+"（步骤"+(o+1)+"）")+" "),s("el-link",{attrs:{type:"danger"},on:{click:function(t){return e.deleteFlowNode(o)}}},[e._v("删除")])],1)}))],2)],1)]),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"process-text"},[s("el-form",{ref:"form",attrs:{"label-position":"top","label-width":"80px"}},[s("el-form-item",{attrs:{label:"文本输入"}},[s("el-input",{ref:"original_text",attrs:{type:"textarea",placeholder:"请输入内容"},on:{input:e.runCode},model:{value:e.originalStr,callback:function(t){e.originalStr=t},expression:"originalStr"}})],1),s("el-form-item",{attrs:{label:"文本输出"}},[s("el-button",{staticStyle:{position:"absolute",right:"0",top:"-40px","z-index":"9"},attrs:{type:"text"},on:{click:e.copyOutput}},[e._v("复制")]),s("el-input",{attrs:{disabled:!0,type:"textarea",placeholder:"输出内容"},model:{value:e.outputStr,callback:function(t){e.outputStr=t},expression:"outputStr"}})],1)],1),s("span",{staticStyle:{color:"#F56C6C"}},[e._v(e._s(e.errMsg))])],1)])],1),s("el-dialog",{attrs:{title:e.codeTitle+"（编写代码逻辑对输入参数 middleStr 进行操作并 return 出结果即可）",visible:e.codeDialogVisible,"before-close":e.handleClose,width:"100%"},on:{"update:visible":function(t){e.codeDialogVisible=t}}},[s("el-form",{ref:"processForm",attrs:{model:e.processForm,rules:e.processRules,"label-width":"100px"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:!e.isProcessEdit,expression:"!isProcessEdit"}]},[s("el-form-item",{attrs:{label:"操作名称",prop:"processName"}},[s("el-input",{attrs:{size:"mini"},model:{value:e.processForm.processName,callback:function(t){e.$set(e.processForm,"processName",t)},expression:"processForm.processName"}})],1),s("el-form-item",{attrs:{label:"操作描述",prop:"processDescribe"}},[s("el-input",{attrs:{size:"mini"},model:{value:e.processForm.processDescribe,callback:function(t){e.$set(e.processForm,"processDescribe",t)},expression:"processForm.processDescribe"}})],1),s("el-form-item",{attrs:{label:"操作主函数",prop:"processMain"}},[s("el-input",{attrs:{size:"mini"},model:{value:e.processForm.processMain,callback:function(t){e.$set(e.processForm,"processMain",t)},expression:"processForm.processMain"}})],1)],1),s("codemirror",{ref:"mycode",staticClass:"code",attrs:{value:e.curCode,options:e.cmOptions},on:{input:e.onCmCodeChange}}),s("p",{staticStyle:{color:"#F56C6C"}},[e._v(e._s(e.testErrMsg))]),s("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isProcessEdit,expression:"isProcessEdit"}],attrs:{type:"primary",size:"mini"},on:{click:e.saveCode}},[e._v("保 存")]),s("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isProcessEdit,expression:"!isProcessEdit"}],attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.addProcess("processForm")}}},[e._v("添 加")])],1)],1)],1)},w=[],b=(s("b0c0"),s("a434"),s("d81d"),s("4de4"),s("d3b7"),s("25f0"),s("0f7c"),s("ec26")),v={methods:{putDb:function(e){e=e._rev?{_id:e._id,data:e.data,_rev:e._rev}:{_id:e._id,data:e.data},utools.db.put(e)},getDb:function(e){return utools.db.get(e)?utools.db.get(e).data:null},getRev:function(e){return utools.db.get(e)?utools.db.get(e)._rev:null},putRevDb:function(e,t){this.putDb({_id:e,data:t,_rev:this.getRev(e)})},setFunc:function(e){utools.setFeature({code:e.id,explain:e.name,cmds:[{type:"regex",label:e.name,match:"/.*?/",minNum:1}]})},removeFunc:function(e){utools.removeFeature(e.id)},hideWindow:function(){utools.hideMainWindow()},exitPlugin:function(){utools.outPlugin()},setHeight:function(e){utools.setExpendHeight(e)},showNote:function(e){utools.showNotification(e)},utoolsCopy:function(e){utools.copyText(e)},utoolsPaste:function(){this.diffOs()?utools.simulateKeyboardTap("v","command"):utools.simulateKeyboardTap("v","ctrl")},diffOs:function(){return!!utools.isMacOs()}}};s("f9d4");var y={name:"FlowEdit",mixins:[v],data:function(){var e=/[^a-zA-Z]+/,t=function(t,s,o){""===s||e.test(s)?o(new Error("请输入全英文的函数名")):o()};return{processFlowName:"",processNode:[],processFlowTime:[],originalStr:"johu    test    plugin   12345",outputStr:"",codeDialogVisible:!1,cmOptions:{value:"",mode:"text/javascript",theme:"ambiance",readOnly:!1},curCode:"",codeTitle:"",errMsg:"",testErrMsg:"",processForm:{processName:"",processDescribe:"",processMain:""},currentEdit:0,processRules:{processName:[{required:!0,message:"请输入操作名称",trigger:"blur"},{min:2,max:10,message:"长度在 2 到 10 个字符",trigger:"blur"}],processDescribe:[{required:!0,message:"请输入操作描述",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],processMain:[{required:!0,validator:t,trigger:"blur"}]},isProcessEdit:!0,isEditFlow:!1,processFlowId:"",dealSuccess:!1}},watch:{originalStr:{handler:function(){0===this.processFlowTime.length&&(this.outputStr=this.originalStr)}}},mounted:function(){var e=this;if(this.getDb("process_node")||this.putDb({_id:"process_node",data:[{name:"去除空格",main:"replaceSpace",code:"return middleStr.replace(/ /g, '')",describe:"去除文本中的所有空格"},{name:"去除换行",main:"replaceWrap",code:"return middleStr.replace(/\\n/g,'')",describe:"去除文本中的所有换行"},{name:"全大写",main:"allUpper",code:"return middleStr.toLocaleUpperCase()",describe:"文本中所有英文字母全大写"},{name:"文本反转",main:"reverse",code:"return middleStr.split('').reverse().join('')",describe:"文本中所有字符反转"}]}),this.processNode=this.getDb("process_node"),this.outputStr=this.originalStr,console.log(this.$route.query),this.$route.query.name){this.processFlowName=this.$route.query.name,this.processFlowId=this.$route.query.id,this.isEditFlow=!0;for(var t=this.$route.query.main,s=t.length,o=this.processNode.length,r=0;r<s;r++)for(var i=0;i<o;i++)t[r]===this.processNode[i].main&&this.processFlowTime.push(this.processNode[i]);this.$route.query.payload&&(this.originalStr=this.$route.query.payload),this.runCode(),this.$route.query.payload&&(this.dealSuccess?(this.hideWindow(),this.chooseMode(),this.showNote("文本处理完成"),this.exitPlugin()):this.showNote("文本处理流程有误"))}else this.isEditFlow=!1;utools.onPluginOut((function(){e.$router.push({name:"FlowManage"})}))},components:{codemirror:m["codemirror"]},methods:{chooseMode:function(){this.copyOutput(),"1"===this.$route.query.operateMode&&this.utoolsPaste()},handleAdd:function(e){this.processFlowTime.length<10?this.processFlowTime.push(this.processNode[e]):this.$message({message:"只能加10个操作，不能再多了",type:"warning"}),this.runCode()},handleDelete:function(e,t){console.log(e,t),this.processNode.splice(e,1),this.saveProcessNode()},addProcessToFlow:function(){this.isProcessEdit=!1,this.codeDialogVisible=!0,this.codeTitle="添加操作",this.curCode="return "},handleEdit:function(e,t){this.currentEdit=e,this.isProcessEdit=!0,this.codeDialogVisible=!0,this.codeTitle=t.name,this.curCode=this.processNode[e].code},deleteFlowNode:function(e){this.processFlowTime.splice(e,1),this.runCode(),0===this.processFlowTime.length&&(this.outputStr=this.originalStr)},copyOutput:function(){this.utoolsCopy(this.outputStr),this.$message({message:"复制成功",type:"success"})},addFlowOrEdit:function(e){var t=this;if(""===this.processFlowName)this.$message({message:"请填写流程名",type:"warning"});else if(0===this.processFlowTime.length)this.$message({message:"至少添加一个操作",type:"warning"});else if(this.dealSuccess){var s=[];this.processFlowTime.map((function(e){s.push(e.main)}));var o=this.getDb("process_flow");e?(o.push({id:Object(b["a"])(),name:this.processFlowName,main:s,isAddPanel:!1,operateMode:"0"}),this.putRevDb("process_flow",o),this.$message({message:"添加流程成功",type:"success"})):(o=o.filter((function(e){return e.id!==t.processFlowId})),o.push({id:this.$route.query.id,name:this.processFlowName,main:s,isAddPanel:this.$route.query.isAddPanel,operateMode:this.$route.query.operateMode}),this.putRevDb("process_flow",o),this.$route.query.isAddPanel&&(this.removeFunc(this.$route.query),this.setFunc({id:this.$route.query.id,name:this.processFlowName})),this.$message({message:"编辑流程成功",type:"success"})),this.$router.push({name:"FlowManage",query:{initPluginReady:!0}})}else this.$message({message:"流程处理错误，查看错误信息并修改",type:"warning"})},backFlow:function(){this.$router.push({name:"FlowManage",query:{initPluginReady:!0}})},handleClose:function(e){this.processForm.processName="",this.processForm.processDescribe="",this.processForm.processMain="",this.testErrMsg="",this.curCode="",e&&e()},saveCode:function(){var e=this,t="middleStr = "+this.processNode[this.currentEdit].main+"(middleStr); function "+this.processNode[this.currentEdit].main+"(middleStr){"+this.curCode+"};return middleStr;";this.testCode(t)?(this.$message({message:"修改成功",type:"success"}),this.processNode[this.currentEdit].code=this.curCode,this.processFlowTime.map((function(t){t.main===e.processNode[e.currentEdit].main&&(t.code=e.curCode)})),this.runCode(),this.saveProcessNode(),this.handleClose()):this.$message({message:"代码测试错误，请查看报错信息并修改",type:"error"})},addProcess:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;var s="middleStr = "+t.processForm.processMain+"(middleStr); function "+t.processForm.processMain+"(middleStr){"+t.curCode+"};return middleStr;",o=t.getDb("process_node"),r=0;o.map((function(e){t.processForm.processMain===e.main&&r++})),0!==r?t.$message({message:"操作主函数名不能重复!",type:"warning"}):t.testCode(s)?(t.$message({message:"添加成功",type:"success"}),t.processNode.push({name:t.processForm.processName,describe:t.processForm.processDescribe,main:t.processForm.processMain,code:t.curCode}),t.saveProcessNode(),t.handleClose()):t.$message({message:"代码测试错误，请查看报错信息并修改",type:"error"})}))},saveProcessNode:function(){this.putRevDb("process_node",this.processNode),this.codeDialogVisible=!1},onCmCodeChange:function(e){this.curCode=e},testCode:function(e){console.log(e),this.testErrMsg="";var t=new Function("middleStr",e);try{return t("test"),!0}catch(s){return this.testErrMsg=s.toString(),console.log(s.toString()),!1}},runCode:function(){var e=this;this.errMsg="",this.dealSuccess=!1;var t="";this.processFlowTime.map((function(s,o){t+="middleStr = "+s.main+"(middleStr); function "+s.main+"(middleStr){"+s.code+"};",o===e.processFlowTime.length-1&&(t+="return middleStr;")})),console.log(t);var s=new Function("middleStr",t);try{this.outputStr=s(this.originalStr),this.dealSuccess=!0}catch(o){this.errMsg=o.toString(),this.dealSuccess=!1,console.log(o.toString())}}}},F=y,_=(s("cbed"),Object(a["a"])(F,g,w,!1,null,"386cef1c",null)),S=_.exports,x=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.processFlow}},[s("el-table-column",{attrs:{prop:"name",label:"流程列表"}}),s("el-table-column",{attrs:{label:"加入超级面板"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#cccccc"},on:{change:function(s){return e.changePanelActive(s,t.row)}},model:{value:t.row.isAddPanel,callback:function(s){e.$set(t.row,"isAddPanel",s)},expression:"scope.row.isAddPanel"}})]}}])}),s("el-table-column",{attrs:{label:"操作模式"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-select",{attrs:{size:"mini",placeholder:"请选择操作模式"},on:{change:function(s){return e.changeOperateMode(s,t.row)}},model:{value:t.row.operateMode,callback:function(s){e.$set(t.row,"operateMode",s)},expression:"scope.row.operateMode"}},e._l(e.operateModeOptions,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),s("el-table-column",{attrs:{label:"流程函数"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.main)+" ")]}}])}),s("el-table-column",{attrs:{width:"130px",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini",icon:"el-icon-edit",circle:"",title:"编辑流程"},on:{click:function(s){return e.handleFlowEdit(t.$index,t.row)}}}),s("el-popconfirm",{staticStyle:{"margin-left":"10px"},attrs:{title:"删除后不可恢复，确定删除吗？"},on:{confirm:function(s){return e.handleFlowDelete(t.$index,t.row)}}},[s("el-button",{attrs:{slot:"reference",size:"mini",type:"danger",icon:"el-icon-delete",circle:"",title:"删除流程"},slot:"reference"})],1)]}}])},[s("template",{slot:"header"},[s("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.addProcessFlow()}}},[e._v("添加流程")])],1)],2)],1)],1)},P=[],M=s("5530"),$={name:"FlowManage",mixins:[v],data:function(){return{processFlow:[],operateModeOptions:[{label:"复制文本",value:"0"},{label:"替换文本",value:"1"}]}},mounted:function(){var e=this;this.$route.query.initPluginReady&&this.initProcessFlow(),utools.onPluginReady((function(){console.log("插件装配完成，已准备好"),e.initProcessFlow()})),utools.onPluginEnter((function(t){var s=t.code,o=t.type,r=t.payload;if(console.log("用户进入插件",s,o,r),"regex"===o){var i=e.getDb("process_flow");e.$router.push({name:"FlowEdit",query:Object(M["a"])({payload:r},i.filter((function(e){if(e.id===s)return e}))[0])})}else"text"===o&&e.initProcessFlow()}))},methods:{initProcessFlow:function(){console.log(this.getDb("process_flow")),this.getDb("process_flow")?this.fixData():this.putDb({_id:"process_flow",data:[{id:"23435fdgs23455342",name:"测试流程",main:["replaceSpace","allUpper"],isAddPanel:!1,operateMode:"0"}]}),this.processFlow=this.getDb("process_flow")},fixData:function(){var e=this.getDb("process_flow");e.map((function(t,s){t.operateMode||(e[s].operateMode="0")})),this.putRevDb("process_flow",e)},changePanelActive:function(e,t){e?this.setFunc(t):this.removeFunc(t);var s=this.getDb("process_flow");s.map((function(o,r){o.id===t.id&&(s[r].isAddPanel=e)})),this.putRevDb("process_flow",s)},changeOperateMode:function(e,t){console.log(e,t);var s=this.getDb("process_flow");s.map((function(o,r){o.id===t.id&&(s[r].operateMode=e)})),this.putRevDb("process_flow",s)},addProcessFlow:function(){this.$router.push({name:"FlowEdit"})},handleFlowEdit:function(e,t){this.$router.push({name:"FlowEdit",query:t})},handleFlowDelete:function(e,t){this.processFlow.splice(e,1),this.putRevDb("process_flow",this.processFlow),this.removeFunc(t)}}},N=$,E=Object(a["a"])(N,x,P,!1,null,"b09da36c",null),C=E.exports;o["default"].use(f["a"]);var D=[{path:"/",name:"FlowManage",component:C},{path:"/FlowEdit",name:"FlowEdit",component:S},{path:"/FlowManage",name:"FlowManage",component:C}],k=new f["a"]({routes:D}),O=k;o["default"].use(h.a),o["default"].use(p.a),o["default"].config.productionTip=!1,new o["default"]({router:O,render:function(e){return e(u)}}).$mount("#app")},"85ec":function(e,t,s){},cbed:function(e,t,s){"use strict";s("18f9")}});